---
title: "Trabalho ASN para criar modelo de Regressão Linear Bodyfat"
output: Modelo de Regressão Linear
---

Estimativa de Gordura corporal e várias medidas de circunferencias para 252 homens.

Density determined from underwater weighing
Percent body fat from Siri's (1956) equation
Age (years)
Weight (lbs)
Height (inches)
Neck circumference (cm)
Chest circumference (cm)
Abdomen 2 circumference (cm)
Hip circumference (cm)
Thigh circumference (cm)
Knee circumference (cm)
Ankle circumference (cm)
Biceps (extended) circumference (cm)
Forearm circumference (cm)
Wrist circumference (cm)


```{r include=FALSE}
library(readr)
library(openxlsx) #biblioteca para escrever arquivo em excel
library(haven)
library(readxl)
library(tidyverse)
library(yardstick) #biblioteca para calcular medidas de erro
library(lmtest) # calcula o teste de homogeneidade de variancia
library(car) # calcula vif
library(ggraph)
library(plotly)
library(ggstance)
library(jtools)
library(olsrr)
library(PerformanceAnalytics)
library(correlation)
library(dplyr)
library(Boruta)
library(nortest)
```

```{r}
path = "D:\\OneDrive\\Pessoal\\ASN.Rocks\\Regressão Linear\\Trabalho\\regressao_linear_R"

setwd(path)
```


Lê o arquivo do *Bodyfat.csv* e carrega o dataframe.


```{r}

Bodyfat <- read_csv("dados/Bodyfat.csv")
# tirando uma variavel que nao sera usada (contexto negocio)
Bodyfat <- Bodyfat %>%
  select(-Density)
```

Variável dependente Abdomen:

Analisando os dados estatisticos.


```{r}
summary(Bodyfat$Abdomen)
```

```{r}
sd(Bodyfat$Abdomen)
```
```{r}
hist(Bodyfat$Abdomen)
```

```{r}
boxplot(Bodyfat$Abdomen)
```
Analisa os outliers

```{r}

Bodyfat_abd = Bodyfat[order(Bodyfat$Abdomen),]

tail(Bodyfat_abd ,3)
```

Identificando se a variável segue uma distribuição normal


Teste de Shapiro-Wilk

Vamos utilizar um vetor que irá conter os dados.

Hipóteses:

H0: Os dados seguem a distribuição normal
H1: Os dados não seguem a distribuição normal

Para a realização desse teste é necessário a instalação do pacote nortest

```{r}
# Carrega pacote
#library(nortest) 
 
# Realiza o teste
testeShapiro <- shapiro.test(Bodyfat$Abdomen)

# Exibe teste
testeShapiro

```
```{r}
filter(Bodyfat, is.na(Abdomen))
```

*Observações Abdomen*:

Percebe-se que o desvio padrão dos dados é relativamente baixo, comparando com os valores disponíveis.

Analisei os maiores valores e menores valores e percebi que não existem valores "incorretos ou inviáveis"

A distribuição não é normal e percebi a presença de outliers nos grandes valores.

-----------------------------------------------------------------------------------------------------------------------

Variável dependente Hip(Quadril):

Analisando os dados estatisticos.

```{r}

summary(Bodyfat$Hip)
sd(Bodyfat$Hip)
hist(Bodyfat$Hip)
boxplot(Bodyfat$Hip)

#Analisando os outliers
Bodyfat_hip = Bodyfat[order(Bodyfat$Hip),]
tail(Bodyfat_hip ,3)

# Carrega pacote
#library(nortest) 
 
# Realiza o teste
testeShapiro <- shapiro.test(Bodyfat$Hip)

# Exibe teste
testeShapiro


filter(Bodyfat, is.na(Hip))

```

*Observações Hip(Quadril)*

Observa-se um baixo desvio padrão, mas com algumas ocorrencias de outliers.

A distribuição não é normal e e percebi que não existem valores "incorretos ou inviáveis".

Ao pesquisar sobre o Quadril, encontrei no site abaixo uma relação entre Abdomen e Quadril. Talvez seja interessante ter uma 
nova variável abrindo novas possibilidades de melhoria do modelo.

https://vitat.com.br/relacao-cintura-quadril/

----------------------------------------------------------------------------------------------------------------------------

Variável dependente Thigh(Coxa):

Analisando os dados estatisticos.

```{r}

summary(Bodyfat$Thigh)
sd(Bodyfat$Thigh)
hist(Bodyfat$Thigh)
boxplot(Bodyfat$Thigh)

#Analisando os outliers
Bodyfat_Thigh = Bodyfat[order(Bodyfat$Thigh),]
tail(Bodyfat_Thigh ,4)

# Carrega pacote
#library(nortest) 
 
# Realiza o teste
testeShapiro <- shapiro.test(Bodyfat$Thigh)

# Exibe teste
testeShapiro


filter(Bodyfat, is.na(Thigh))

```
*Observações Thigh(Coxa)*

Observa-se um baixo desvio padrão, mas com ocorrencias de outliers um pouco maior do que as anteriores.

A distribuição não é normal e e percebi que não existem valores "incorretos ou inviáveis".

Não encontrei nenhuma particularidade sobre a coxa em relação as demais partes do corpo

----------------------------------------------------------------------------------------------------------------------
*Variável dependente Knee(Joelho):*

Analisando os dados estatisticos.


```{r}

summary(Bodyfat$Knee)
sd(Bodyfat$Knee)
hist(Bodyfat$Knee)
boxplot(Bodyfat$Knee)

#Analisando os outliers
Bodyfat_Knee= Bodyfat[order(Bodyfat$Knee),]
tail(Bodyfat_Knee ,4)

# Carrega pacote
#library(nortest) 
 
# Realiza o teste
testeShapiro <- shapiro.test(Bodyfat$Knee)

# Exibe teste
testeShapiro


filter(Bodyfat, is.na(Knee))

```
*Observações Knee(Joelho)*

Observa-se um desvio padrão muito pequeno, mas com ocorrencias de outliers. Leva a pensar se é uma variável importante, ja que sua variável é tão baixa.

A distribuição não é normal e e percebi que não existem valores "incorretos ou inviáveis".

Não encontrei nenhuma particularidade sobre a Joelho em relação as demais partes do corpo

--------------------------------------------------------------------------------------------------------------------------
*Variável dependente Ankle(Tornozelo):*

Analisando os dados estatisticos.

```{r}

summary(Bodyfat$Ankle)
sd(Bodyfat$Ankle)
hist(Bodyfat$Ankle)
boxplot(Bodyfat$Ankle)

#Analisando os outliers
Bodyfat_Ankle= Bodyfat[order(Bodyfat$Ankle),]
tail(Bodyfat_Ankle ,4)

# Carrega pacote
#library(nortest) 
 
# Realiza o teste
testeShapiro <- shapiro.test(Bodyfat$Ankle)

# Exibe teste
testeShapiro


filter(Bodyfat, is.na(Ankle))

```


Análise da Variável Age

```{r}
summary(Bodyfat$Age)
sd(Bodyfat$Age)
hist(Bodyfat$Age)
boxplot(Bodyfat$Age)
plot(Bodyfat$Age, Bodyfat$bodyfat)

#Analisando os outliers
Bodyfat_Age= Bodyfat[order(Bodyfat$Age),]
tail(Bodyfat_Age ,4)

 
# Realiza o teste
testeShapiro_Age <- shapiro.test(Bodyfat$Age)

# Exibe teste
testeShapiro_Age




reg_simples_Age <- lm(bodyfat ~ Age, data=Bodyfat)
summary(reg_simples_Age)

meus_desenhos <- Bodyfat %>% mutate(chute_media_Age = mean(Bodyfat$bodyfat),chute_modelo_Age = reg_simples_Age$fitted.values)

arte <- ggplot()
arte <- arte + geom_point(data=meus_desenhos, aes(x=bodyfat, y=bodyfat), color = "black" ) +
  labs(title = "",
       x = "Age",
       y = "real_arte",
       color = "green")
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_media_Age, y=bodyfat), color = "gray" )
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_modelo_Age, y=bodyfat), color = "blue" )
arte

```
Análise da variável Weight

```{r}
summary(Bodyfat$Weight)
sd(Bodyfat$Weight)
hist(Bodyfat$Weight)
boxplot(Bodyfat$Weight)
plot(Bodyfat$Weight, Bodyfat$bodyfat)

reg_simples_Weight <- lm(bodyfat ~ Weight, data=Bodyfat)
summary(reg_simples_Weight)

#Analisando os outliers
Bodyfat_Weight= Bodyfat[order(Bodyfat$Weight),]
tail(Bodyfat_Weight ,4)

 
# Realiza o teste
testeShapiro_Weight <- shapiro.test(Bodyfat$Weight)

# Exibe teste
testeShapiro_Weight

meus_desenhos <- Bodyfat %>% mutate(chute_media_Weight = mean(Bodyfat$bodyfat),chute_modelo_Weight = reg_simples_Weight$fitted.values)

arte <- ggplot()
arte <- arte + geom_point(data=meus_desenhos, aes(x=bodyfat, y=bodyfat), color = "black" ) +
  labs(title = "",
       x = "Weight",
       y = "real_arte",
       color = "green")
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_media_Weight, y=bodyfat), color = "gray" )
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_modelo_Weight, y=bodyfat), color = "blue" )
arte


```

Análise da variável Height

```{r}

summary(Bodyfat$Height)
sd(Bodyfat$Height)
hist(Bodyfat$Height)
boxplot(Bodyfat$Height)
plot(Bodyfat$Height, Bodyfat$bodyfat)


reg_simples_Height <- lm(bodyfat ~ Height, data=Bodyfat)
summary(reg_simples_Height)

#Analisando os outliers
Bodyfat_Height= Bodyfat[order(Bodyfat$Height),]
tail(Bodyfat_Height ,4)

 
# Realiza o teste
testeShapiro_Height <- shapiro.test(Bodyfat$Height)

# Exibe teste
testeShapiro_Height

meus_desenhos <- Bodyfat %>% mutate(chute_media_Height = mean(Bodyfat$bodyfat),chute_modelo_Height = reg_simples_Height$fitted.values)

arte <- ggplot()
arte <- arte + geom_point(data=meus_desenhos, aes(x=bodyfat, y=bodyfat), color = "black" ) +
  labs(title = "",
       x = "Height",
       y = "real_arte",
       color = "green")
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_media_Height, y=bodyfat), color = "gray" )
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_modelo_Height, y=bodyfat), color = "blue" )
arte

```
Análise da Variável Neck

```{r}
summary(Bodyfat$Neck)
sd(Bodyfat$Neck)
hist(Bodyfat$Neck)
boxplot(Bodyfat$Neck)
plot(Bodyfat$Neck, Bodyfat$bodyfat)

reg_simples_Neck <- lm(bodyfat ~ Neck, data=Bodyfat)
summary(reg_simples_Neck)

#Analisando os outliers
Bodyfat_Neck= Bodyfat[order(Bodyfat$Neck),]
tail(Bodyfat_Neck ,4)

 
# Realiza o teste
testeShapiro_Neck<- shapiro.test(Bodyfat$Neck)

# Exibe teste
testeShapiro_Neck


meus_desenhos <- Bodyfat %>% mutate(chute_media_Neck = mean(Bodyfat$bodyfat),chute_modelo_Neck = reg_simples_Neck$fitted.values)

arte <- ggplot()
arte <- arte + geom_point(data=meus_desenhos, aes(x=bodyfat, y=bodyfat), color = "black" ) +
  labs(title = "",
       x = "Neck",
       y = "real_arte",
       color = "green")
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_media_Neck, y=bodyfat), color = "gray" )
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_modelo_Neck, y=bodyfat), color = "blue" )
arte




```
Análise da variável Chest

```{r}

summary(Bodyfat$Chest)
sd(Bodyfat$Chest)
hist(Bodyfat$Chest)
boxplot(Bodyfat$Chest)
plot(Bodyfat$Chest, Bodyfat$bodyfat)

reg_simples_Chest <- lm(bodyfat ~ Chest, data=Bodyfat)
summary(reg_simples_Chest)

#Analisando os outliers
Bodyfat_Chest= Bodyfat[order(Bodyfat$Chest),]
tail(Bodyfat_Chest ,4)

 
# Realiza o teste
testeShapiro_Chest<- shapiro.test(Bodyfat$Chest)

# Exibe teste
testeShapiro_Chest

meus_desenhos <- Bodyfat %>% mutate(chute_media_Chest = mean(Bodyfat$bodyfat),chute_modelo_Chest = reg_simples_Chest$fitted.values)

arte <- ggplot()
arte <- arte + geom_point(data=meus_desenhos, aes(x=bodyfat, y=bodyfat), color = "black" ) +
  labs(title = "",
       x = "Chest",
       y = "real_arte",
       color = "green")
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_media_Chest, y=bodyfat), color = "gray" )
arte
arte <- arte + geom_point(data=meus_desenhos, aes(x=chute_modelo_Chest, y=bodyfat), color = "blue" )
arte


```
Teste de Feature Importance usando o Algoritmo Boruta

```{r}
library(Boruta)
set.seed(111)
boruta.bodyfat <- Boruta(bodyfat ~ ., data = Bodyfat, doTrace = 2)
print(boruta.bodyfat)

plot(boruta.bodyfat, xlab = "", xaxt = "n")
lz<-lapply(1:ncol(boruta.bodyfat$ImpHistory),function(i)
  boruta.bodyfat$ImpHistory[is.finite(boruta.bodyfat$ImpHistory[,i]),i])
names(lz) <- colnames(boruta.bodyfat$ImpHistory)
Labels <- sort(sapply(lz,median))
axis(side = 1,las=2,labels = names(Labels),
     at = 1:ncol(boruta.bodyfat$ImpHistory), cex.axis = 0.7)


#### Executando o algoritmo Boruta, observamos que para ele, quase todas as
#### variáveis são importantes, com exeção do tornozelo. Sem dúvida, a mais 
#### importante é o abdome, seguido da circunferência do peito.


```

Density: Determinada através da pesagem sub-aquatica
	- A Distribuição é Normal
	- Coeficiente de variação: 1.8% muito baixo, o que indica uma baixa variabilidade dos dados.
	- Existe um valor outlier para baixo: 0.995000 que jogando na fórmula de Cálculo do BodyFat (495/D - 450) vai ocorrer
	o maior valor de bodyfat: 47,49. É provável que este valor esteja incorreto uma vez que todos os outros valores são menores 
	comparado a outros valores cujo bodyfat é menor. Não está fazendo sentido.
	
Conclusão, excluir a linha deste outlier

bodyfat: Percentual de gordura do corpo, de acordo com a equação do Siri (1956): 495/Densidade - 450
	- A Distribuição é Normal
	- Coeficiente de variação: 43.61%, demonstra uma variabilidade alta (acima de 25%)
	- Existe um valor zerado, o que não faz sentido uma vez que todos possuem algum nível de gordura corporal.
	- Existe um outlier, que ja será excluído na análise anterior
	
Conclusão, excluir a linah cujo o bodyfat seja igual a 0.

Age: Idade
	- A Distribuição não é normal
	- O Coeficiente de variação é alto (28,02%), indicando uma alta variabilidade dos dados
	- não existem outliers e nem dados inválidos
	- o mais jovem possuem 22 anos e o mais velho possui 81 anos
	- a maior parte dos dados encontra-se entre 35 e 54 anos
	
Conclusão, sem nenhuma alteração

Weight: Peso
	- A Distribuição não é Normal
	- Coeficiente de variação: 16.39%, ou seja, uma baixa variabilidade dos dados
	- Exsitem dois outlier`s, um com 165,1 kg e outro com 119.4

Conclusão, essa linha com o peso de 165.1 kg, possui também um IMC de 50.6. Esse IMC acima de 50 sera uma exclusão por 
ser um valor muito alto em relação ao ultimo nível da tabela de IMCS que é 40.

A outra linha outlier, não será excluída neste critério

Height: Altura
	- A Distribuição não é Normal
	- Coeficiente de variação: 5.58%, ou seja, baixa variabilidade
	- Existe uma linha cuja pessoa mede 70 centimentros, o que é muito abaixo dos padrões.
	
Conclusão: Essa linha deverá ser excluída, uma vez que o IMC também está 171.3, o que me parece ser algo impossível


Neck: Pescoço
    - A Distribuição não é Normal
    - Coeficiente de variação: 6.39%, ou seja, baixa variabilidade
	- Existem 3 outliers, dois com valores menores e 1 com valor maior. O de maior valor, será excluído quando excluírmos os IMCS maiores que 50.
	Os de menores valores, aparentemente estão dentro dos valore possíveis e não precisam ser excluídos.
	

Chest: Peito
	- A Distribuição não é Normal
	- Coeficiente de variação: 8.34%, ou seja, baixa variabilidade
	- Existem dois outliers. O de maior valor, ja será excluido pelo IMC. O outro, não há motivo aparente para a exclusão
	
	
Abdomen: Abdomen
	- A Distribuição não é Normal
	- Coeficiente de variação: 11.63%
	- Existem três outliers, mas o de maior valor e o de terceiro maior valor, ja estarão excluidos por outros critérios. O valor do meio, será mantido.

Hip: Quadril
	- A Distribuição não é Normal
	- Coeficiente de variação: 7.16%, ou seja, a variabilidade é baixa
	- Existem três outliers onde o de maior valor ja será excluido pelo critério do IMC>50
	
Thigh: Coxa
	- A Distribuição não é Normal
	- Coeficiente de variação: 8.82%, ou seja, a variabilidade é baixa
	- Existem alguns outliers onde o de maior valor ja será excluido pelo critério do IMC>50
	
Knee: Joelho
	- A Distribuição não é Normal
	- Coeficiente de variação: 6.24%, ou seja, a variabilidade é baixa
	- Existem três outliers onde o de maior valor ja será excluido pelo critério do IMC>50
	
Ankle: Tornozelo
	- A Distribuição não é Normal
	- Coeficiente de variação: 7.32%, ou seja, a variabilidade é baixa
	- Existem três outliers onde o de terceiro de maior valor ja será excluido pelo critério do IMC>50
	
Biceps:Biceps
	- A Distribuição não é Normal
	- Coeficiente de variação: 9.34%, ou seja, a variabilidade é baixa
	- Existe somente um outlier que ja será excluido pelo critério do IMC>50
	
Forearm: Antebraço
	- A Distribuição não é Normal
	- Coeficiente de variação: 7.04%
	- Exsitem 5 outliers, 4 abaixo e 1 acima. Nenhum será excluído.
	
Wrist: Pulso
	- A Distribuição é Normal
	- Coeficiente de variação: 5.11%, variabilidade muito baixa
	- Existem outliers acima e abaixo. Nenhum será excluído
	

IMC: Indice de massa corporal
	- A Distribuição não é Normal
	- Coeficiente de variação: 36.76%, altava variabilidade
	- Existem outliers e todos que forem acima de 50 serão excluidos

	

